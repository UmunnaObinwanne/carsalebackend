(function(g,s,u){"use strict";function T(o){return o&&o.__esModule?o:{default:o}}var t=T(g);const w=o=>{const{onChange:n,property:r,record:l}=o,m=a=>{if(a.target.files&&a.target.files[0]){const i=new FormData;i.append("images",a.target.files[0]),fetch("/upload-image",{method:"POST",body:i}).then(e=>e.json()).then(e=>{e.imageUrls&&e.imageUrls.length>0&&n(r.name,e.imageUrls[0])}).catch(e=>console.error("Error uploading image:",e))}};return t.default.createElement("div",null,t.default.createElement("label",null,r.label),l.params.featuredImage&&t.default.createElement("img",{src:`http://localhost:5000/uploads/${l.params.featuredImage}`,alt:"featured",style:{width:"100%",maxHeight:"200px",objectFit:"cover"}}),t.default.createElement("input",{type:"file",accept:"image/*",onChange:m}))},v=({property:o,record:n,onChange:r})=>{const{translateProperty:l}=u.useTranslation(),{params:m}=n,{custom:a}=o,i=u.flat.get(m,a.filePathProperty),e=u.flat.get(m,a.keyProperty),f=u.flat.get(m,a.fileProperty),[c,I]=g.useState(e),[P,U]=g.useState([]);g.useEffect(()=>{(typeof e=="string"&&e!==c||typeof e!="string"&&!c||typeof e!="string"&&Array.isArray(e)&&e.length!==c.length)&&(I(e),U([]))},[e,c]);const k=p=>{U(p),r(a.fileProperty,p)},x=()=>{r(a.fileProperty,null)},J=p=>{const d=(u.flat.get(n.params,a.keyProperty)||[]).indexOf(p),b=u.flat.get(n.params,a.filesToDeleteProperty)||[];if(i&&i.length>0){const S=i.map((_,$)=>$!==d?_:null);let h=u.flat.set(n.params,a.filesToDeleteProperty,[...b,d]);h=u.flat.set(h,a.filePathProperty,S),r({...n,params:h})}else console.log("You cannot remove file when there are no uploaded files yet")};return t.default.createElement(s.FormGroup,null,t.default.createElement(s.Label,null,l(o.label,o.resourceId)),t.default.createElement(s.DropZone,{onChange:k,multiple:a.multiple,validate:{mimeTypes:a.mimeTypes,maxSize:a.maxSize},files:P}),!a.multiple&&e&&i&&!P.length&&f!==null&&t.default.createElement(s.DropZoneItem,{filename:e,src:i,onRemove:x}),a.multiple&&e&&e.length&&i?t.default.createElement(t.default.Fragment,null,e.map((p,d)=>i[d]?t.default.createElement(s.DropZoneItem,{key:p,filename:p,src:i[d],onRemove:()=>J(p)}):"")):"")},D=["audio/aac","audio/midi","audio/x-midi","audio/mpeg","audio/ogg","application/ogg","audio/opus","audio/wav","audio/webm","audio/3gpp2"],A=["image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/vnd.microsoft.icon","image/tiff","image/webp"],y=o=>{const{name:n,path:r,mimeType:l,width:m}=o;if(r&&r.length){if(l&&A.includes(l))return t.default.createElement("img",{src:r,style:{maxHeight:m,maxWidth:m},alt:n});if(l&&D.includes(l))return t.default.createElement("audio",{controls:!0,src:r},"Your browser does not support the",t.default.createElement("code",null,"audio"),t.default.createElement("track",{kind:"captions"}))}return t.default.createElement(s.Box,null,t.default.createElement(s.Button,{as:"a",href:r,ml:"default",size:"sm",rounded:!0,target:"_blank"},t.default.createElement(s.Icon,{icon:"DocumentDownload",color:"white",mr:"default"}),n))},E=({width:o,record:n,property:r})=>{const{custom:l}=r;let m=u.flat.get(n?.params,l.filePathProperty);if(!m)return null;const a=u.flat.get(n?.params,l.fileNameProperty?l.fileNameProperty:l.keyProperty),i=l.mimeTypeProperty&&u.flat.get(n?.params,l.mimeTypeProperty);if(!r.custom.multiple)return l.opts&&l.opts.baseUrl&&(m=`${l.opts.baseUrl}/${a}`),t.default.createElement(y,{path:m,name:a,width:o,mimeType:i});if(l.opts&&l.opts.baseUrl){const e=l.opts.baseUrl||"";m=m.map((f,c)=>`${e}/${a[c]}`)}return t.default.createElement(t.default.Fragment,null,m.map((e,f)=>t.default.createElement(y,{key:e,path:e,name:a[f],width:o,mimeType:i[f]})))},C=o=>t.default.createElement(E,{width:100,...o}),F=o=>{const{property:n}=o,{translateProperty:r}=u.useTranslation();return t.default.createElement(s.FormGroup,null,t.default.createElement(s.Label,null,r(n.label,n.resourceId)),t.default.createElement(E,{width:"100%",...o}))};AdminJS.UserComponents={},AdminJS.UserComponents.ImageUpload=w,AdminJS.UserComponents.UploadEditComponent=v,AdminJS.UserComponents.UploadListComponent=C,AdminJS.UserComponents.UploadShowComponent=F})(React,AdminJSDesignSystem,AdminJS);
